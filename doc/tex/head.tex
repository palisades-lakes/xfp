%-------------------------------------------------------------------------------
\errorcontextlines 10000
%-------------------------------------------------------------------------------
%input path
%-------------------------------------------------------------------------------
\makeatletter
\def\input@path{{../figs/}{../tex/}{../rawtex/}{../}}
\makeatother
%-------------------------------------------------------------------------------
% TODO: try these
% \usepackage{amsmath,amsfonts,amssymb,mathrsfs,theorem}
% \usepackage{multicol,multirow,calc,achicago,graphicx,color,colortab,rotating,enumerate}
% \usepackage{pstricks,psfrag,tabularx,comment,hyperref}
% \usepackage{boxedminipage}
% \usepackage{bbm}
% Graphics
% \usepackage{graphicx}
% %Tables
% \usepackage{booktabs}
% \usepackage{lscape}
% \usepackage{bbold}
% \usepackage{natbib}
% \def\newblock{\hskip .11em plus .33em minus .07em}
% \usepackage{url}
% \usepackage{citeref}
% \citestyle{authoryear}
% \usepackage{hyperref}
%-------------------------------------------------------------------------------
\usepackage{coseoul}
% used to revert to sub-document's top level
\newcounter{baseSectionLevel}
%-------------------------------------------------------------------------------
% layout file determines 1/2 col, landscape/portrait...
\usepackage{geometry}
%-------------------------------------------------------------------------------
\usepackage{color}
\usepackage[dvipsnames,svgnames,x11names]{xcolor}
%-------------------------------------------------------------------------------
\usepackage{graphics}
\usepackage{epsfig}
\usepackage{graphicx}
\PassOptionsToPackage{normalem}{ulem}
\usepackage{ulem}
%-------------------------------------------------------------------------------
\usepackage{url}
%-------------------------------------------------------------------------------
\usepackage[english]{babel}
%-------------------------------------------------------------------------------
%\usepackage{csquotes}
%-------------------------------------------------------------------------------
\usepackage{epigraph}
\setlength{\epigraphwidth}{\linewidth}
%-------------------------------------------------------------------------------
\usepackage{fontspec}
%-------------------------------------------------------------------------------
%\setmainfont{Baskerville Old Face}
%\setmainfont{Libre Caslon Text}[Scale=0.85]
%\setmainfont{Centaur}
%\setmainfont{Garamond}
%\setmainfont{Georgia}
%\setmainfont{Perpetua}
%\setmainfont{Poor Richard}

% http://www.impallari.com/projects/overview/libre-caslon-display-and-text
%\setmainfont{Libre Caslon Text}[Scale=0.85]
%\newfontfamily\scshape[Letters=SmallCaps,Scale=1.15]{Crimson}

% http://iginomarini.com/fell/the-revival-fonts/
% \fontspec[
%  SmallCapsFont=IM FELL English SC,
%  SmallCapsFeatures={Letters=SmallCaps},
% ]{IM FELL English}
% \setmainfont{IM FELL English}
 
% https://github.com/CatharsisFonts/Cormorant/releases/tag/v3.3 

% http://www.georgduffner.at/ebgaramond/download.html
% \fontspec[
%  SmallCapsFeatures={Letters=SmallCaps},
% ]{EB Garamond}
\setmainfont[
Path,
UprightFont = *12-Regular,
ItalicFont  = *12-Italic,
BoldFont    = *08-Regular,
BoldItalicFont = *08-Italic ]
{EBGaramond}

% https://www.microsoft.com/typography/fonts/family.aspx?FID=134
% \fontspec[
%  SmallCapsFeatures={Letters=SmallCaps},
% ]{Garamond}
% \setmainfont{Garamond}
%\setmainfont{Palatino Linotype}
%\setmainfont{Perpetua}[Scale=1.1]
%\setmainfont{Times New Roman}
%-------------------------------------------------------------------------------
% https://www.microsoft.com/typography/fonts/family.aspx?FID=155
\setsansfont{Gill Sans MT} 

% http://arkandis.tuxfamily.org/adffonts.html
% \setsansfont{Gillius ADF}
%-------------------------------------------------------------------------------
% \setmonofont{}
%-------------------------------------------------------------------------------
% \usepackage{xeCJK}
% \setCJKmainfont{SimHei}
% \setCJKsansfont{SimHei}
% \setCJKmonofont{Lucida Sans Typewriter}
%-------------------------------------------------------------------------------
\usepackage{amsmath}
\usepackage{amssymb}
\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathOperator*{\argmax}{argmax}
\DeclareMathOperator*{\sign}{sign}
\DeclareMathOperator*{\defeq}
{\overset{\underset{\mathrm{def}}{}}{=}}
%\DeclareMathOperator*{\cdf}{cdf}
%\DeclareMathOperator*{\quantile}{quantile}
\newcommand\bigforall{\mbox{\Large $\mathsurround0pt\forall$}} 
%https://tex.stackexchange.com/questions/83509/hfill-in-math-mode
\makeatletter
\newcommand{\pushright}[1]{\ifmeasuring@#1\else\omit\hfill$\displaystyle#1$\fi\ignorespaces}
\newcommand{\pushleft}[1]{\ifmeasuring@#1\else\omit$\displaystyle#1$\hfill\fi\ignorespaces}
\newcommand{\specialcell}[1]{\ifmeasuring@#1\else\omit$\displaystyle#1$\ignorespaces\fi}\makeatother
\makeatother
% https://tex.stackexchange.com/questions/14071/how-can-i-increase-the-line-spacing-in-a-matrix
\makeatletter
\renewcommand*\env@matrix[1][\arraystretch]{%
  \edef\arraystretch{#1}%
  \hskip -\arraycolsep
  \let\@ifnextchar\new@ifnextchar
  \array{*\c@MaxMatrixCols c}}
\makeatother
% https://tex.stackexchange.com/questions/42726/align-but-show-one-equation-number-at-the-end/42728#42728
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}
%-----------------------------------------------------------------
\usepackage{mathtools}
%-----------------------------------------------------------------
\usepackage{amsthm}
\usepackage{thmtools}

% https://tex.stackexchange.com/questions/249963/remove-repeated-theorem-in-the-list-of-theorems
\usepackage{etoolbox}
\makeatletter
\patchcmd\thmt@mklistcmd
  {\thmt@thmname}
  {\check@optarg{\thmt@thmname}}
  {}{}
\patchcmd\thmt@mklistcmd
  {\thmt@thmname\ifx}
  {\check@optarg{\thmt@thmname}\ifx}
  {}{}
\protected\def\check@optarg#1{%
  \@ifnextchar\thmtformatoptarg\@secondoftwo{#1}%
}
\makeatother

% \newtheoremstyle{break}%
% {}{}%
% {}{}%
% {}{}% % Note that final punctuation is omitted.
% {\newline}{}
% \theoremstyle{break}
% \newtheorem{example}{Example}[section]
% \newtheorem{definition}{\textsf{Definition}}[section]
% \newtheorem{fact}{\textsf{Fact}}[section]
%\DeclareRobustCommand{\rvspace}[1]{\vspace{#1}}
% \theoremstyle{break}
\declaretheoremstyle[
% TODO: should be relative to parskip, or something like that
spaceabove=16pt,
spacebelow=12pt,
headfont=\normalfont\mdseries,
headpunct={\vspace{\topsep}\newline\vspace{\topsep}\vspace{\topsep}},
%notefont=\sffamily\bfseries, 
notefont=\sffamily, 
notebraces={\hspace{1em}}{},
shaded={bgcolor=GhostWhite},
bodyfont=\normalfont,
postheadspace=1em,
]{mythmstyle}
\declaretheorem[style=mythmstyle,title=Theorem,name={Theorem}]{theorem}
\declaretheorem[style=mythmstyle,title=Definition,name={Definition}]{definition}
\declaretheorem[style=mythmstyle,title=Example,name={Example}]{example}
%\renewcommand{\thmtformatoptarg}[1]{#1}%
%-----------------------------------------------------------------
\numberwithin{theorem}{chapter}
\numberwithin{definition}{chapter}
\numberwithin{example}{chapter}
\numberwithin{equation}{chapter}
\numberwithin{figure}{chapter}
%-----------------------------------------------------------------
\usepackage{listings}
\lstset{backgroundcolor={\color{GhostWhite}},
basicstyle={\ttfamily\small},
breaklines=false,
captionpos=b,
%frame=tblr,
mathescape=true,
escapechar=\%,
keywordstyle={\ttfamily}}
%\renewcommand{\lstlistingname}{Listing}
%\renewcommand{\lstlistingname}{}
% \providecommand{\algorithmname}{Algorithm}
% \providecommand{\exercisename}{Exercise}
% \providecommand{\theoremname}{Theorem}
% \providecommand{\examplename}{Example}
%-----------------------------------------------------------------
% \makeatletter
% \let\orig@item\item
% 
% \def\item{%
%     \@ifnextchar{[}%
%         {\lstinline@item}%
%         {\orig@item}%
% }
% 
% \begingroup
% \catcode`\]=\active
% \gdef\lstinline@item[{%
%     \setbox0\hbox\bgroup
%         \catcode`\]=\active
%         \let]\lstinline@item@end
% }
% \endgroup
% 
% \def\lstinline@item@end{%
%     \egroup
%     \orig@item[\usebox0]%
% }
% \makeatother
%-------------------------------------------------------------------------------
\usepackage{algpseudocode,algorithm,algorithmicx}
%-------------------------------------------------------------------------------
\usepackage{datetime}
\renewcommand{\dateseparator}{-}
\renewcommand{\today}{
\the\year \dateseparator \twodigit\month \dateseparator \twodigit\day}
%-------------------------------------------------------------------------------
\setlength{\parskip}{5pt}
\setlength{\parindent}{0pt}
\usepackage[parfill]{parskip}
%-------------------------------------------------------------------------------
% \usepackage{fancyhdr}
% \pagestyle{fancy}
% \setlength{\headwidth}{\textheight}
% \addtolength{\headwidth}{\columnsep}
% %\addtolength{\headwidth}{\marginparsep}
% %\addtolength{\headwidth}{\marginparwidth}
% \fancypagestyle{plain}{
% \fancyhead{} % clear all head fields 
% \fancyfoot{} % clear all foot fields
% \fancyfoot[RO,LE]{\textsf{\thepage}} 
% \fancyfoot[RE,LO]{\textsf{Draft of \today}}
% \renewcommand{\headrulewidth}{0.0pt}
% \renewcommand{\footrulewidth}{0.1pt}}
% \pagestyle{plain}
%-------------------------------------------------------------------------------
\usepackage{titling}
%\newfontfamily\titlefont[Scale=MatchUppercase]{Gill Sans MT}
%\renewcommand{\maketitlehooka}{\titlefont}
\pretitle{\begin{flushright}\Huge\sffamily\bfseries}
\posttitle{\par\end{flushright}\vskip 0.25em}
\preauthor{\begin{flushright}\sffamily\scshape\mdseries}
\postauthor{\par\end{flushright}}
\predate{\begin{flushright}\sffamily\scshape\mdseries}
\postdate{\par\end{flushright}}
\setlength{\droptitle}{-80pt}
%-------------------------------------------------------------------------------
\usepackage{enumitem}
\setlist[description]{font=\small\sffamily\mdseries,style=unboxed,leftmargin=0cm}
\setlist[itemize]{style=unboxed,itemindent=0cm}
\setlist[enumerate]{style=unboxed,itemindent=0cm}
%-------------------------------------------------------------------------------
\usepackage[sf,small,compact]{titlesec}
%\newfontfamily\headingfont[]{New Yorker}
%\newfontfamily\headingfont[Scale=MatchUppercase]{Libre Caslon Display}
%\newfontfamily\headingfont[]{Perpetua Titling MT}
%\newfontfamily\headingfont[Scale=MatchUppercase]{Gill Sans MT}
%\newfontfamily\headingfont[Scale=MatchUppercase]{Gillius ADF}

\titleformat{\part}{\huge\sffamily\bfseries}{\thepart}{0.5em}{}
\titleformat{\chapter}{\LARGE\sffamily\bfseries}{\thechapter}{0.5em}{}
\titleformat{\section}{\Large\sffamily\bfseries}{\thesection}{0.5em}{}
\titleformat{\subsection}{\large\sffamily\bfseries}{\thesubsection}{0.5em}{}
\titleformat{\subsubsection}{\large\sffamily\mdseries}{\thesubsubsection}{0.5em}{}
\titleformat{\paragraph}[runin]{\normalsize\sffamily\mdseries}{\theparagraph}{0.5em}{}[\hspace{1em}]
\titleformat{\subparagraph}[runin]{\normalsize\sffamily\mdseries}{\thesubparagraph}{0.5em}{}[\hspace{1em}]

\titlespacing\section{0pt}{12pt plus 12pt minus 2pt}{5pt plus 5pt minus 2pt}
\titlespacing\subsection{0pt}{11pt plus 11pt minus 2pt}{5pt plus 5pt minus 2pt}
\titlespacing\subsubsection{0pt}{10pt plus 10pt minus 2pt}{5pt plus 5pt minus 2pt}

\setcounter{secnumdepth}{7}
%-------------------------------------------------------------------------------
\makeatletter
\let\oldl@chapter\l@chapter
\def\l@chapter#1#2{\oldl@chapter{#1}{\textsf{#2}}}
\let\old@dottedcontentsline\@dottedtocline
\def\@dottedtocline#1#2#3#4#5{%
\old@dottedcontentsline{#1}{#2}{#3}{#4}{{\textsf{#5}}}}
\makeatother
%-------------------------------------------------------------------------------
% \usepackage{tocloft}
% \renewcommand{\cftpartfont}{\sffamily}
% \renewcommand{\cftchapfont}{\sffamily}
% \renewcommand{\cftsecfont}{\sffamily}
% \renewcommand{\cftsubsecfont}{\sffamily}
% \renewcommand{\cftsubsubsecfont}{\sffamily}
% \renewcommand{\cftparafont}{\sffamily}
% \renewcommand{\cftsubparafont}{\sffamily}
%-------------------------------------------------------------------------------
\usepackage{enumitem}
%\setlist[description]{font=\small\sffamily\mdseries,style=unboxed,leftmargin=0cm}
\setlist[description]{font=\sffamily\mdseries}
% \setlist[itemize]{style=unboxed,itemindent=0cm}
% \setlist[enumerate]{style=unboxed,itemindent=0cm}
%-------------------------------------------------------------------------------
%https://en.wikibooks.org/wiki/LaTeX/Indexing
\usepackage{makeidx}
\makeindex
\usepackage[totoc]{idxlayout}
%-------------------------------------------------------------------------------
\usepackage[
backend=biber, 
citestyle=numeric-comp, 
bibstyle=numeric,
%bibstyle=verbose,
%entrykey=false,
labelnumber=true,
sortcites=true,
maxnames=1000,
maxitems=1000,
block=nbpar,
abbreviate=false,
date=edtf,
alldates=edtf,
datezeros=true,
timezeros=true,
]{biblatex} 
\renewcommand\mkbibnamefamily[1]{\textsc{#1}}
%-------------------------------------------------------------------------------
% \usepackage[chapter]{tocbibind}
% \renewcommand{\listfigurename}{Figures}
% \setlofname{Figures}
% \renewcommand{\listoffigures}{\begingroup
% \tocchapter
% \tocfile{\listfigurename}{lof}
% \endgroup}
%-------------------------------------------------------------------------------
%\usepackage[titletoc]{appendix}
%-------------------------------------------------------------------------------
\usepackage[unicode=true,pdfusetitle,
 bookmarks=true,bookmarksnumbered=false,bookmarksopen=true,bookmarksopenlevel=1,
 breaklinks=false,pdfborder={0 0 0},backref=false,colorlinks=true]{hyperref}
% these renewcommands don't seem to work
% \renewcommand{\chapterautorefname}{\S}
% \renewcommand{\sectionautorefname}{\S}
% \renewcommand{\subsectionautorefname}{\S}
% \renewcommand{\subsubsectionautorefname}{\S}
\hypersetup{unicode=true,
colorlinks=true,
pdfpagemode=UseOutlines,
pdfpagelayout=OneColumn,
pdfstartview=Fit,
linkcolor=MidnightBlue,
urlcolor=Mahogany,
citecolor=OliveGreen}
%-------------------------------------------------------------------------------
% %\usepackage[xindy,toc,style=alttreehypergroup,nolong,nosuper]{glossaries}
% \usepackage[xindy,toc,style=alttreehypergroup,nolong,nosuper]{glossaries}
%-------------------------------------------------------------------------------
